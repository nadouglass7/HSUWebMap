document.onmousedown=function(TheEvent){"use strict";var TargetContainedInPopupWindow=false;if(CMMainContainer.PopupWindow!==null){TargetContainedInPopupWindow=jQuery.contains(CMMainContainer.PopupWindow,TheEvent.target);}var TargetIsPopupWindow=false;if(TheEvent.target===CMMainContainer.PopupWindow){TargetIsPopupWindow=true;}if((TargetContainedInPopupWindow===false)&&(TargetIsPopupWindow===false)){CMMainContainer.HidePopupWindow();}};CMMainContainer.SetPopupWindow=function(NewPopupWindow){"use strict";CMMainContainer.HidePopupWindow();CMMainContainer.PopupWindow=NewPopupWindow;};CMMainContainer.HidePopupWindow=function(){"use strict";if(CMMainContainer.PopupWindow!==null){CMMainContainer.PopupWindow.style.visibility="hidden";}CMMainContainer.PopupWindow=null;};CMMainContainer.MAP_CONTAINER=0;CMMainContainer.TOOL_CONTAINER=1;CMMainContainer.TOOL_EDIT=2;CMMainContainer.TOOL_INFO=3;CMMainContainer.TOOL_PAN=4;CMMainContainer.CANVAS_CONTAINER=5;CMMainContainer.CANVAS=6;CMMainContainer.LAYER_LIST=7;CMMainContainer.MAP_FOOTER=8;CMMainContainer.MAP_COORDINATES=9;CMMainContainer.MAP_SRS=10;CMMainContainer.MAP_CREDITS=11;CMMainContainer.NAVIGATION=12;CMMainContainer.BACKGROUND_LIST=13;CMMainContainer.SEARCH_PANEL=14;CMMainContainer.VERTICAL_TAB_CONTAINER=15;CMMainContainer.HORIZIONAL_TAB_CONTAINER=16;CMMainContainer.SETTINGS_PANEL=17;CMMainContainer.TIME_EDITOR_PANEL=18;CMMainContainer.ATTRIBUTE_PANEL=19;CMMainContainer.TIME_SLIDER_PANEL=20;CMMainContainer.NUM_ELEMENTS=21;CMMainContainer.GESTURE_ZOOM=0.2;CMMainContainer.GESTURE_PAN=8;CMMainContainer.NumMaps=0;CMMainContainer.PopupWindow=null;CMMainContainer.ELEMENT_DEFS=[["CM_MapContainer","div","CM_MapContainer"],["CM_ToolContainer","div","CM_ToolContainer"],["CM_ToolEdit","div","CM_Tool"],["CM_ToolInfo","div","CM_Tool"],["CM_ToolPan","div","CM_Tool"],["CM_CanvasContainer","div","CM_CanvasContainer"],["CM_Canvas","CANVAS","CM_Canvas"],["CM_LayerList","div","CM_TabContent"],["CM_MapFooter","div","CM_MapFooter"],["CM_MapCoordinates","div","CM_Credits"],["CM_SRS","div","CM_Credits"],["CM_Credits","div","CM_Credits"],["CM_Navigation","div","CM_Navigation"],["CM_BackgroundList","div","CM_TabContent"],["CM_SearchPanel","div","CM_TabContent"],["CM_TabContainer","div","CM_TabContainer"],["CM_HorizontalTabContainer","div","CM_HorizontalTabContainer"],["CM_SettingsPanel","div","CM_TabContent"],["CM_TimeEditPanel","div","CM_TimeEditPanel"],["CM_AttributePanel","div","CM_AttributePanel"],["CM_TimeSliderPanel","div","CM_TimeSliderPanel"]];function CMMainContainer(){"use strict";this.ExistingElements=true;this.ImageFolder="../Images/";this.HorizontalMargin=10;this.MobileSupported=false;this.Index=CMMainContainer.NumMaps;CMMainContainer.NumMaps++;this.TheScene=null;this.Elements=null;this.Test=false;this.DebugPanel=null;this.ToolPanel=null;this.PanelFooter=null;this.PanelSettings=null;this.PanelLayerList=null;this.PanelBackgrounds=null;this.PanelSearch=null;}CMMainContainer.prototype=Object.create(CMBase.prototype);CMMainContainer.prototype.contructor=CMMainContainer;CMMainContainer.prototype.SetTest=function(New){this.Test=New;};CMMainContainer.MouseWheel=function(TheEvent){"use strict";var Result;CMMainContainer.HidePopupWindow();var TheEvent=window.event||TheEvent
var Result=this.TheCanvasMap.TheScene.GetView(0).MouseWheel(TheEvent);return(Result);};CMMainContainer.prototype.Private_CreateElements=function(){if(this.Elements==null)this.Elements=new Array(CMMainContainer.NUM_ELEMENTS);for(var i=0;i<this.Elements.length;i++){if(this.Elements[i]===undefined){var ElementID=CMMainContainer.ELEMENT_DEFS[i][0]+"_"+this.Index;if(this.ExistingElements){this.Elements[i]=document.getElementById(ElementID);}if(this.Elements[i]==undefined){this.Elements[i]=document.createElement(CMMainContainer.ELEMENT_DEFS[i][1]);this.Elements[i].id=ElementID;}if(CMMainContainer.ELEMENT_DEFS[i][2]!=null){this.Elements[i].className=CMMainContainer.ELEMENT_DEFS[i][2];}}}};CMMainContainer.prototype.SetImageFolder=function(ImageFolder){"use strict";this.ImageFolder=ImageFolder;};CMMainContainer.prototype.SetCoordinateUnits=function(CoordinateUnits){if(this.PanelFooter!=null){this.PanelFooter.CoordinateUnits=CoordinateUnits;}};CMMainContainer.prototype.SetDebugPanel=function(NewDebugPanel){this.DebugPanel=NewDebugPanel;};CMMainContainer.prototype.AddToDebugPanel=function(NewHTML){if(this.DebugPanel!=null){this.DebugPanel.innerHTML+=NewHTML+"<br>";}};CMMainContainer.prototype.SetElement=function(ElementIndex,Element){if(this.Elements==null)this.Elements=new Array(CMMainContainer.NUM_ELEMENTS);if(typeof(Element)=="string"){Element=document.getElementById(Element);}this.Elements[ElementIndex]=Element;};CMMainContainer.prototype.GetElement=function(ElementIndex){return(this.Elements[ElementIndex]);};CMMainContainer.prototype.SimpleMap=function(){this.SetElement(CMMainContainer.TOOL_CONTAINER,null);this.SetElement(CMMainContainer.NAVIGATION,null);this.SetElement(CMMainContainer.VERTICAL_TAB_CONTAINER,null);this.SetElement(CMMainContainer.LAYER_LIST,null);this.SetElement(CMMainContainer.BACKGROUND_LIST,null);this.SetElement(CMMainContainer.SEARCH_PANEL,null);this.SetElement(CMMainContainer.SETTINGS_PANEL,null);this.SetElement(CMMainContainer.MAP_FOOTER,null);};CMMainContainer.prototype.SetMobileSupported=function(MobileSupported){this.MobileSupported=MobileSupported;};CMMainContainer.prototype.Initialize=function(AllowMouseEvents,Create3DScene){if(AllowMouseEvents==undefined)AllowMouseEvents=true;this.Private_CreateElements();var TheView;if(Create3DScene===true){this.TheScene=new CMScene3D();TheView=new CMView3D();}else{this.TheScene=new CMScene(this);TheView=new CMView2D();}this.TheScene.SetParent(this);this.TheScene.AddView(TheView);TheView.Setup(this.Elements[CMMainContainer.CANVAS_CONTAINER],this.Elements[CMMainContainer.CANVAS]);var MapContainer=this.Elements[CMMainContainer.MAP_CONTAINER];MapContainer.TheCanvasMap=this;MapContainer.OriginalMouseDown=MapContainer.onmousedown;var CanvasContainer=this.Elements[CMMainContainer.CANVAS_CONTAINER];if(CMUtilities.IsDefined(CanvasContainer)){MapContainer.appendChild(CanvasContainer);}var TheCanvasElement=this.Elements[CMMainContainer.CANVAS];if(CMUtilities.IsDefined(TheCanvasElement)){CanvasContainer.appendChild(TheCanvasElement);}var ToolContainer=this.Elements[CMMainContainer.TOOL_CONTAINER];if(CMUtilities.IsDefined(ToolContainer)){MapContainer.appendChild(ToolContainer);}var TabContainer=this.Elements[CMMainContainer.VERTICAL_TAB_CONTAINER];if(CMUtilities.IsDefined(TabContainer)){this.TabPanel=new CMPanelTabs(this);this.TabPanel.SetElement(TabContainer);MapContainer.appendChild(TabContainer);var LayerListElement=this.Elements[CMMainContainer.LAYER_LIST];if(CMUtilities.IsDefined(LayerListElement)){this.PanelLayerList=new CMPanelLayerList(this);var TheLayerListTab=this.TabPanel.AddTab("Layers","Layers",undefined,LayerListElement);this.PanelLayerList.SetElement(LayerListElement);}var SettingsPanelElement=this.Elements[CMMainContainer.SETTINGS_PANEL];if(CMUtilities.IsDefined(SettingsPanelElement)){this.PanelSettings=new CMPanelSettings(this);var TheSettingsTab=this.TabPanel.AddTab("Settings","Settings",null,SettingsPanelElement);this.PanelSettings.SetElement(SettingsPanelElement);}var PanelBackgroundsElement=this.Elements[CMMainContainer.BACKGROUND_LIST];if(CMUtilities.IsDefined(PanelBackgroundsElement)){this.PanelBackgrounds=new CMPanelBackgrounds(this);var TheBackgroundsTab=this.TabPanel.AddTab("Background","Background",null,PanelBackgroundsElement);this.PanelBackgrounds.SetElement(PanelBackgroundsElement);}var SearchPanelElement=this.Elements[CMMainContainer.SEARCH_PANEL];if(CMUtilities.IsDefined(SearchPanelElement)){this.PanelSearch=new CMPanelSearch(this);var TheSearchTab=this.TabPanel.AddTab("Search","Search",null,SearchPanelElement);this.PanelSearch.SetElement(SearchPanelElement);}}var ToolContainer=this.GetElement(CMMainContainer.TOOL_CONTAINER);if(CMUtilities.IsDefined(ToolContainer)){this.ToolPanel=new CMPanelTool(this);this.ToolPanel.SetElement(ToolContainer);var EditTool=this.GetElement(CMMainContainer.TOOL_EDIT);if(CMUtilities.IsDefined(EditTool)){var TheTool=this.ToolPanel.AddTool(EditTool,this.ImageFolder+"IconArrow_20w_Default.png",this.ImageFolder+"IconArrow_20w_Selected.png",this,'Click to get information on features or drag the map',function(TheCanvasMap){TheCanvasMap.SelectTool(CMView.TOOL_SELECT);});TheTool.CMMainContainer=this;}var PanTool=this.GetElement(CMMainContainer.TOOL_PAN);if(CMUtilities.IsDefined(PanTool)){var TheTool=this.ToolPanel.AddTool(PanTool,this.ImageFolder+"IconHand_20w_Default.png",this.ImageFolder+"IconHand_20pixels_Selected.png",this,'Click to get information on features or drag the map',function(TheCanvasMap){TheCanvasMap.SelectTool(CMView.TOOL_HAND);});TheTool.CMMainContainer=this;}var InfoTool=this.GetElement(CMMainContainer.TOOL_INFO);if(CMUtilities.IsDefined(InfoTool)){var TheTool=this.ToolPanel.AddTool(InfoTool,this.ImageFolder+"Icon_I_Default.png",this.ImageFolder+"Icon_I_Selected.png",this,'Click to get information on features or drag the map',function(TheCanvasMap){TheCanvasMap.SelectTool(CMView.TOOL_INFO);});TheTool.CMMainContainer=this;}this.ToolPanel.MakeToolGroup([EditTool,PanTool,InfoTool]);var ZoomInButton=document.createElement("DIV");ZoomInButton.id="ZoomIn_0";ZoomInButton.className="CM_Tool";var TheTool=this.ToolPanel.AddTool(ZoomInButton,this.ImageFolder+"Icon_ZoomIn_Small_17H.png",this.ImageFolder+"Icon_ZoomIn_Small_17H.png",this,'Click to zoom into the map',function(TheCanvasMap){this.CMMainContainer.GetScene().GetView(0).ZoomIn();});TheTool.CMMainContainer=this;var HomeButton=document.createElement("DIV");HomeButton.id="Home_0";HomeButton.className="CM_Tool";var TheTool=this.ToolPanel.AddTool(HomeButton,this.ImageFolder+"Icon_HomeExtent_small_17H.png",this.ImageFolder+"Icon_HomeExtent_small_17H.png",this,'Click to zoom into the map',function(TheCanvasMap){this.CMMainContainer.GetScene().GetView(0).ZoomToMaxBounds();});TheTool.CMMainContainer=this;var ZoomOutButton=document.createElement("DIV");ZoomOutButton.id="ZoomOut_0";var TheTool=this.ToolPanel.AddTool(ZoomOutButton,this.ImageFolder+"Icon_ZoomOut_Small_17H.png",this.ImageFolder+"Icon_ZoomOut_Small_17H.png",this,'Click to zoom into the map',function(TheCanvasMap){this.CMMainContainer.GetScene().GetView(0).ZoomOut();});TheTool.CMMainContainer=this;this.ToolPanel.MakeToolGroup([ZoomInButton,HomeButton,ZoomOutButton]);}var MapFooter=this.Elements[CMMainContainer.MAP_FOOTER];if(CMUtilities.IsDefined(MapFooter)){this.PanelFooter=new CMPanelFooter(this);this.PanelFooter.SetElement(MapFooter);MapContainer.appendChild(MapFooter);}var HoriziontalTabContainerElement=this.Elements[CMMainContainer.HORIZIONAL_TAB_CONTAINER];if(CMUtilities.IsDefined(HoriziontalTabContainerElement)){this.HoriziontalTabContainer=new CMPanelTabs(this);this.HoriziontalTabContainer.SetElement(HoriziontalTabContainerElement);var TimeEditorPanelElement=this.Elements[CMMainContainer.TIME_EDITOR_PANEL];if(CMUtilities.IsDefined(TimeEditorPanelElement)){this.PanelTimeline=new CMPanelTime(this);this.PanelTimeline.SetElement(TimeEditorPanelElement);var TimeEditorTab=this.HoriziontalTabContainer.AddTab("Timeline","Timeline",null,TimeEditorPanelElement);var TheSettingsPanel=this.GetPanelSettings();this.PanelTimeline.SetSettingsPanel(TheSettingsPanel);}var AttributePanelElement=this.Elements[CMMainContainer.ATTRIBUTE_PANEL];if(CMUtilities.IsDefined(AttributePanelElement)){var TheAttributePanel=new CMPanelAttributes(this);TheAttributePanel.SetElement(AttributePanelElement);var TimeEditorTab=this.HoriziontalTabContainer.AddTab("Attributes","Attributes",null,AttributePanelElement);}}if(AllowMouseEvents){TheView.AddMouseEventHandlers();}var LayerListWidth=0;var MapFooterHeight=0;if(this.Elements[CMMainContainer.VERTICAL_TAB_CONTAINER]!=null){LayerListWidth=jQuery(this.Elements[CMMainContainer.VERTICAL_TAB_CONTAINER]).width();}if(this.Elements[CMMainContainer.MAP_FOOTER]!=null){MapFooterHeight=jQuery(this.Elements[CMMainContainer.MAP_FOOTER]).height();}var MapMarginRight=LayerListWidth+this.HorizontalMargin;var CanvasContainer=this.GetElement(CMMainContainer.CANVAS_CONTAINER);if(this.MobileSupported){TheView.AddMobileEvents();}};CMMainContainer.prototype.GetScene=function(){return(this.TheScene);};CMMainContainer.prototype.GetView=function(){return(this.TheScene.GetView(0));};CMMainContainer.prototype.GetToolPanel=function(){return(this.ToolPanel);};CMMainContainer.prototype.GetPanelFooter=function(){return(this.PanelFooter);};CMMainContainer.prototype.GetPanelSettings=function(){return(this.PanelSettings);};CMMainContainer.prototype.SetPanelSettings=function(NewPanelSettings){this.PanelSettings=NewPanelSettings;};CMMainContainer.prototype.GetPanelTimeline=function(){return(this.PanelTimeline);};CMMainContainer.prototype.SetProjector=function(TheProjector){this.TheScene.SetProjector(TheProjector);};CMMainContainer.prototype.GetProjector=function(){return(this.TheScene.GetProjector());};CMMainContainer.prototype.SelectTool=function(ViewToolDef){if(this.TheScene.GetView(0)==null){alert("Sorry, CMMainContainer.SelectTool() cannot be called until after Initialize() is called()");}this.TheScene.GetView(0).SetTool(ViewToolDef);};CMMainContainer.prototype.AddLayer=function(NewLayer){var LayerIndex=-1;if(this.TheScene==null){alert("Sorry, CMMainContainer.AddLayer() cannot be called until after Initialize() is called()");}else{LayerIndex=this.TheScene.AddLayer(NewLayer);}return(LayerIndex);};CMMainContainer.prototype.AddBackground=function(NewLayer){if(this.TheScene==null){alert("Sorry, CMMainContainer.AddBackground() cannot be called until after Initialize() is called()");}else{this.TheScene.AddBackground(NewLayer);}};CMMainContainer.prototype.StartMap=function(ResizeFlag){if(CMUtilities.IsDefined(this.TabPanel)){this.TabPanel.SelectTab("Layers");}if(ResizeFlag){this.Resize();}else{this.TheScene.Resize();}};CMMainContainer.prototype.ZoomIn=function(){if(this.TheScene.GetView(0)==null){alert("Sorry, CMMainContainer.ZoomIn() cannot be called until after Setup() is called()");}else this.TheScene.GetView(0).ZoomIn();};CMMainContainer.prototype.ZoomOut=function(){if(this.TheScene.GetView(0)==null){alert("Sorry, CMMainContainer.ZoomOut() cannot be called until after Setup() is called()");}else this.TheScene.GetView(0).ZoomOut();};CMMainContainer.prototype.ZoomToMax=function(){var SceneBounds=this.TheScene.GetBounds();if(SceneBounds!=null){this.TheScene.GetView(0).ZoomToBounds(SceneBounds);}};CMMainContainer.prototype.ZoomToBounds=function(TheBounds){if(this.TheScene.GetView(0)==null){alert("Sorry, CMMainContainer.ZoomToBounds() cannot be called until after Setup() is called()");}else this.TheScene.GetView(0).ZoomToBounds(TheBounds);};CMMainContainer.prototype.ZoomTo=function(ZoomLevel){if(this.TheScene.GetView(0)==null){alert("Sorry, CMMainContainer.ZoomTo() cannot be called until after Setup() is called()");}else this.TheScene.GetView(0).ZoomTo(ZoomLevel);};CMMainContainer.prototype.SetRefCenter=function(RefX,RefY){if(this.TheScene.GetView(0)==null){alert("Sorry, CMMainContainer.SetRefCenter() cannot be called until after Setup() is called()");}else this.TheScene.GetView(0).SetRefCenter(RefX,RefY);};CMMainContainer.prototype.Resize=function(){CMMainContainer.HidePopupWindow();this.TheScene.Resize();};