function CMToolHandler(ObjectType){this.ObjectType=ObjectType;}CMToolHandler.prototype.MouseDown=function(TheView,RefX,RefY,TheEvent){var Used=false;{var ItemIndex=-1;var NewObject=null;switch(this.ObjectType){case"Rectangle":NewObject=new CMItemRect(CMItemRect.RECTANGLE);ItemIndex=this.TheLayer.AddObject(NewObject);NewObject.SetControlBounds(RefX,RefX,RefY,RefY);break;case"RoundedRectangle":NewObject=new CMItemRect(CMItemRect.ROUNDED_RECTANGLE);ItemIndex=this.TheLayer.AddObject(NewObject);NewObject.SetControlBounds(RefX,RefX,RefY,RefY);break;case"Oval":NewObject=new CMItemRect(CMItemRect.OVAL);ItemIndex=this.TheLayer.AddObject(NewObject);NewObject.SetControlBounds(RefX,RefX,RefY,RefY);break;case"Curve":NewObject=new CMItemPoly();ItemIndex=this.TheLayer.AddObject(NewObject);var Xs=[RefX,RefX];var Ys=[RefY,RefY];NewObject.SetControlPoints(0,Xs,Ys);break;case"Arrow":NewObject=new CMItemPolyArrow();ItemIndex=this.TheLayer.AddObject(NewObject);var Xs=[RefX,RefX];var Ys=[RefY,RefY];NewObject.SetControlPoints(0,Xs,Ys);break;}this.TheLayer.TheItems[ItemIndex].StartCreating(RefX,RefY);this.TheLayer.TheItems[ItemIndex].SetSelected(true);this.TheLayer.SelectedItemIndex=ItemIndex;Used=true;}return(Used);}
CMToolHandler.prototype.MouseMove=function(TheView,RefX,RefY){return(false);}
CMToolHandler.prototype.MouseUp=function(TheView,RefX,RefY){return(false);}
function CMLayerItems(){CMLayer.call(this);this.TheItems=[];this.SelectedItemIndex=-1;this.ToolGroupElement=null;}CMLayerItems.prototype=Object.create(CMLayer.prototype);CMLayerItems.prototype.contructor=CMLayerItems;CMLayerItems.prototype.Unselected=function(){if(this.ToolGroupElement!=null){var TheCanvasMap=this.GetParent(CMMainContainer);var TheToolPanel=TheCanvasMap.GetToolPanel();TheToolPanel.RemoveTool("CMLayerObjects_RectImage");TheToolPanel.RemoveTool("CMLayerObjects_RoundedRectImage");TheToolPanel.RemoveTool("CMLayerObjects_OvalImage");TheToolPanel.RemoveTool("CMLayerObjects_CurveImage");TheToolPanel.RemoveTool("CMLayerObjects_ArrowImage");TheToolPanel.RemoveToolGroupElement(this.ToolGroupElement);this.ToolGroupElement=null;var TheView=TheCanvasMap.GetView();TheView.SetToolHandler(null);}}
CMLayerItems.prototype.GetNumChildren=function(){return(this.TheItems.length);}
CMLayerItems.prototype.GetChild=function(Index){return(this.TheItems[Index]);}
CMLayerItems.prototype.CMLayer_UnselectAll=CMLayer.prototype.UnselectAll;CMLayerItems.prototype.UnselectAll=function(SendMessage){this.CMLayer_UnselectAll(SendMessage);for(var i=0;i<this.TheItems.length;i++){this.TheItems[i].UnselectAll(SendMessage);}this.Unselected();}
CMLayerItems.prototype.CMLayer_SetSelected=CMLayer.prototype.SetSelected;CMLayerItems.prototype.SetSelected=function(New){if(New!=this.GetSelected()){this.CMLayer_SetSelected(New);var TheCanvasMap=this.GetParent(CMMainContainer);var TheToolPanel=TheCanvasMap.GetToolPanel();if(New){{var RectTool=TheToolPanel.AddTool("CMLayerObjects_RectImage",TheCanvasMap.ImageFolder+"Icon_Rect_Default.png",TheCanvasMap.ImageFolder+"Icon_Rect_Selected.png");CMLayerItems.SetupTool(RectTool,this,"Rectangle");var RoundRectTool=TheToolPanel.AddTool("CMLayerObjects_RoundedRectImage",TheCanvasMap.ImageFolder+"Icon_RoundedRect_Default.png",TheCanvasMap.ImageFolder+"Icon_RoundedRect_Selected.png");CMLayerItems.SetupTool(RoundRectTool,this,"RoundedRectangle");var OvalTool=TheToolPanel.AddTool("CMLayerObjects_OvalImage",TheCanvasMap.ImageFolder+"Icon_Oval_Default.png",TheCanvasMap.ImageFolder+"Icon_Oval_Selected.png");CMLayerItems.SetupTool(OvalTool,this,"Oval");var CurveTool=TheToolPanel.AddTool("CMLayerObjects_CurveImage",TheCanvasMap.ImageFolder+"Icon_Curve_Default.png",TheCanvasMap.ImageFolder+"Icon_Curve_Selected.png");CMLayerItems.SetupTool(CurveTool,this,"Curve");var ArrowTool=TheToolPanel.AddTool("CMLayerObjects_ArrowImage",TheCanvasMap.ImageFolder+"Icon_Arrow_Default.png",TheCanvasMap.ImageFolder+"Icon_Arrow_Selected.png");CMLayerItems.SetupTool(ArrowTool,this,"Arrow");this.ToolGroupElement=TheToolPanel.MakeToolGroup([RectTool,RoundRectTool,OvalTool,CurveTool,ArrowTool]);}{}}else{this.Unselected();}}}
CMLayerItems.SetupTool=function(TheTool,TheLayer,ObjectType){TheTool.TheLayer=TheLayer;TheTool.ObjectType=ObjectType;TheTool.Original_onclick=TheTool.onclick;TheTool.onclick=function(){TheTool.Original_onclick();var TheCanvasMap=this.TheLayer.GetParent(CMMainContainer);var TheToolPanel=TheCanvasMap.GetToolPanel();var TheView=TheCanvasMap.GetView();var TheToolHandler=new CMToolHandler(this.ObjectType);TheToolHandler.TheLayer=this.TheLayer;TheView.SetToolHandler(TheToolHandler);}
TheTool.UnselectFunction=function(){var TheCanvasMap=this.TheLayer.GetParent(CMMainContainer);var TheView=TheCanvasMap.GetView();TheView.SetToolHandler(null);}}
CMLayerItems.prototype.CMLayer_GetTimeSlices=CMLayer.prototype.GetTimes;CMLayerItems.prototype.GetTimes=function(TheTimeSlices){TheTimeSlices=this.CMLayer_GetTimeSlices(TheTimeSlices);for(var i=0;i<this.TheItems.length;i++){TheTimeSlices=this.TheItems[i].GetTimes(TheTimeSlices);}return(TheTimeSlices);}
CMLayerItems.prototype.In=function(TheView,RefX,RefY){var ItemIndex=-1;if((this.IsVisible())&&(this.TheItems!=null)){var Tolerance=TheView.GetRefWidthFromPixelWidth(this.ClickTolerance);for(var i=0;(i<this.TheItems.length)&&(ItemIndex==-1);i++){var Result=false;var Part=this.TheItems[i].InPart(TheView,RefX,RefY,3);if(Part!=-1)ItemIndex=i;}}return(ItemIndex);};CMLayerItems.prototype.MouseDown=function(TheView,RefX,RefY,TheEvent){var Used=false;if((this.IsVisible())&&(this.GetClickable())){if((Used==false)&&((TheView.GetTool()==CMView.TOOL_INFO)||(TheView.GetTool()==CMView.TOOL_SELECT))){var ItemIndex=this.In(TheView,RefX,RefY);if(ItemIndex!=-1){this.TheItems[ItemIndex].MouseDown(TheView,RefX,RefY,TheEvent);if(this.TheItems[ItemIndex].GetSelected()){this.SelectedItemIndex=ItemIndex;Used=true;}}}}return(Used);};CMLayerItems.prototype.MouseMove=function(TheView,RefX,RefY,TheEvent){var Used=false;if(this.Clickable){for(var i=0;(i<this.TheItems.length)&&(Used==false);i++){var Result=false;if(this.TheItems[i].GetSelected()){Used=this.TheItems[i].MouseMove(TheView,RefX,RefY,TheEvent);}}}return(Used);};CMLayerItems.prototype.MouseUp=function(TheView,RefX,RefY,TheEvent){var Used=false;if(this.Clickable){for(var i=0;(i<this.TheItems.length)&&(Used==false);i++){var Result=false;if(this.TheItems[i].GetSelected()){Used=this.TheItems[i].MouseUp(TheView,RefX,RefY,TheEvent);}}}return(Used);};CMLayerItems.prototype.ShowInfoWindow=function(FeatureIndex,TheView,RefX,RefY){var TheFeatures=this.TheData.features;var TheFeature=TheFeatures[FeatureIndex];var Properties=TheFeature.properties;var TheHTML=this.GetFeatureSetting("Layer","InfoText",FeatureIndex,null);if(TheHTML!=null){var InfoWindow=TheView.CreateInfoWindow("CMLayerItems.InfoWindow",RefX,RefY,this.GetInfoWindowWidth(),30,TheHTML);CMMainContainer.SetPopupWindow(InfoWindow);}};CMLayerItems.prototype.Paint=function(TheView){if((this.IsVisible())&&(this.TheItems!=null)){this.GetCanvasMap().AddToDebugPanel(this.GetName()+" Starting Paint:"+CMUtilities.GetSeconds());var TheStyle=this.GetStyle(TheView);if(TheStyle!=undefined)TheView.SetStyle(TheStyle);for(var i=0;i<this.TheItems.length;i++){var TheObject=this.TheItems[i];TheObject.Paint(TheView);}if(TheStyle!=undefined)TheView.RestoreStyle();this.GetCanvasMap().AddToDebugPanel(this.GetName()+" Leaving Paint:"+CMUtilities.GetSeconds());}}
CMLayerItems.prototype.PaintSelected=function(TheView){if(this.IsVisible()){TheView.SaveStyle();for(var i=0;i<this.TheItems.length;i++){var TheItem=this.TheItems[i];TheItem.PaintSelected(TheView);}TheView.RestoreStyle();}}
CMLayerItems.prototype.AddObject=function(TheObject){this.TheItems.push(TheObject);TheObject.SetParent(this);this.Repaint();this.GetParent(CMScene).LayerContentChanged(this);return(this.TheItems.length-1);}