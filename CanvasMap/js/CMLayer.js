CMLayer.MARK_CIRCLE=0;CMLayer.MARK_TRIANGLE=1;CMLayer.MARK_SQUARE=2;CMLayer.MARK_STAR=3;CMLayer.LabelDirections=["TL","T","TR","R","BR","B","BL","L"];CMLayer.SettingDefintions={Layer:{InfoText:{Name:"Info Text",Type:CMBase.DATA_TYPE_STRING,Default:"Undefined"},MinZoom:{Name:"Min Zoom",Type:CMBase.DATA_TYPE_FLOAT,Default:0},MaxZoom:{Name:"Max Zoom",Type:CMBase.DATA_TYPE_FLOAT,Default:0},},Mark:{Type:{Name:"Type",Type:CMBase.DATA_TYPE_ENUMERATED,Options:[CMLayer.MARK_CIRCLE,CMLayer.MARK_TRIANGLE,CMLayer.MARK_SQUARE,CMLayer.MARK_STAR],Default:CMLayer.MARK_CIRCLE},Size:{Name:"Size",Type:CMBase.DATA_TYPE_FLOAT,Default:3},},IconImage:{URL:{Name:"URL",Type:CMBase.DATA_TYPE_URL,Default:""},TheImage:{Name:"Image",Type:CMBase.DATA_TYPE_IMAGE,Default:null},OffsetX:{Name:"Offset X",Type:CMBase.DATA_TYPE_FLOAT,Default:0},OffsetY:{Name:"Offset Y",Type:CMBase.DATA_TYPE_FLOAT,Default:0},},LabelBox:{Position:{Name:"Position",Type:CMBase.DATA_TYPE_ENUMERATED,Options:["TL","T","TR","R","BR","B","BL","L"],Default:"UR"},OffsetX:{Name:"Offset X",Type:CMBase.DATA_TYPE_FLOAT,Default:0},OffsetY:{Name:"Offset Y",Type:CMBase.DATA_TYPE_FLOAT,Default:0},strokeStyle:{Name:"Line Style",Type:CMBase.DATA_TYPE_CSS_STYLE,Default:"rgb(0,0,0)"},lineWidth:{Name:"Width",Type:CMBase.DATA_TYPE_INTEGER,Default:1},lineCap:{Name:"Line Cap",Type:CMBase.DATA_TYPE_ENUMERATED,Options:['butt','round','square'],Default:'round'},lineJoin:{Name:"Line Join",Type:CMBase.DATA_TYPE_ENUMERATED,Options:['bevel','round','miter'],Default:'round'},fillStyle:{Name:"Fill Style",Type:CMBase.DATA_TYPE_CSS_STYLE,Default:"rgb(255,255,255)"},shadowColor:{Name:"Shadow Color",Type:CMBase.DATA_TYPE_COLOR,Default:"rgb(0,0,0)"},shadowBlur:{Name:"Shadow Blur",Type:CMBase.DATA_TYPE_FLOAT,Default:1},shadowOffsetX:{Name:"Shadow X Offset",Type:CMBase.DATA_TYPE_FLOAT,Default:1},shadowOffsetY:{Name:"Shadow Y Offset",Type:CMBase.DATA_TYPE_FLOAT,Default:1}},MouseOverStyle:{strokeStyle:{Name:"Line Style",Type:CMBase.DATA_TYPE_CSS_STYLE,Default:"rgb(255,0,0)"},lineWidth:{Name:"Width",Type:CMBase.DATA_TYPE_INTEGER,Default:1},lineCap:{Name:"Line Cap",Type:CMBase.DATA_TYPE_ENUMERATED,Options:['butt','round','square'],Default:'round'},lineJoin:{Name:"Line Join",Type:CMBase.DATA_TYPE_ENUMERATED,Options:['bevel','round','miter'],Default:'round'},fillStyle:{Name:"Fill Style",Type:CMBase.DATA_TYPE_CSS_STYLE,Default:"rgb(255,255,255)"},shadowColor:{Name:"Shadow Color",Type:CMBase.DATA_TYPE_COLOR,Default:"rgb(0,0,0)"},shadowBlur:{Name:"Shadow Blur",Type:CMBase.DATA_TYPE_FLOAT,Default:1},shadowOffsetX:{Name:"Shadow X Offset",Type:CMBase.DATA_TYPE_FLOAT,Default:1},shadowOffsetY:{Name:"Shadow Y Offset",Type:CMBase.DATA_TYPE_FLOAT,Default:1}},SelectedStyle:{strokeStyle:{Name:"Line Style",Type:CMBase.DATA_TYPE_CSS_STYLE,Default:"rgb(0,0,255)"},lineWidth:{Name:"Width",Type:CMBase.DATA_TYPE_INTEGER,Default:1},lineCap:{Name:"Line Cap",Type:CMBase.DATA_TYPE_ENUMERATED,Options:['butt','round','square'],Default:'round'},lineJoin:{Name:"Line Join",Type:CMBase.DATA_TYPE_ENUMERATED,Options:['bevel','round','miter'],Default:'round'},fillStyle:{Name:"Fill Style",Type:CMBase.DATA_TYPE_CSS_STYLE,Default:"rgb(255,255,255)"},shadowColor:{Name:"Shadow Color",Type:CMBase.DATA_TYPE_COLOR,Default:"rgb(0,0,0)"},shadowBlur:{Name:"Shadow Blur",Type:CMBase.DATA_TYPE_FLOAT,Default:1},shadowOffsetX:{Name:"Shadow X Offset",Type:CMBase.DATA_TYPE_FLOAT,Default:1},shadowOffsetY:{Name:"Shadow Y Offset",Type:CMBase.DATA_TYPE_FLOAT,Default:1}},};function CMLayer(){CMItem.call(this);this.TheBounds=null;this.Clickable=true;this.FeatureBounds=null;var SettingsDirty=false;this.Name=null;this.ClickTolerance=8;this.InfoWindowWidth=300;this.TimeSlices[0].Settings.Layer={};this.TimeSlices[0].Settings.Mark={};this.TimeSlices[0].Settings.IconImage={};this.TimeSlices[0].Settings.LabelBox={};this.TimeSlices[0].Settings.MouseOverStyle={};this.TimeSlices[0].Settings.SelectedStyle={strokeStyle:"rgb(120,100,255)",lineWidth:"3",fillStyle:"rgba(0,0,0,0)"};this.FeatureSettings=null;this.SettingsAttributes=null;}CMLayer.prototype=Object.create(CMItem.prototype);CMLayer.prototype.contructor=CMLayer;CMLayer.prototype.SettingsChanged=function(){if(this.SettingsDirty){if(this.SettingsAttributes!=null){var j=12;}}}
CMLayer.prototype.GetName=function(){return(this.Name);}
CMLayer.prototype.CMItem_GetSettingsDefinitions=CMItem.prototype.GetSettingsDefinitions;CMLayer.prototype.GetSettingsDefinitions=function(){var Result=this.CMItem_GetSettingsDefinitions();for(Key in CMLayer.SettingDefintions){Result[Key]=CMLayer.SettingDefintions[Key];}return(Result);}
CMLayer.prototype.SetName=function(Name){this.Name=Name;if(this.GetScene()!=null)this.GetScene().LayerSettingsChanged(this);}
CMLayer.prototype.SetClickable=function(Clickable){if(Clickable!=this.Clickable){this.Clickable=Clickable;}};CMLayer.prototype.GetClickable=function(){return(this.Clickable);};CMLayer.prototype.IsVisible=function(){var Result=this.GetVisible();if(Result){var MinZoom=this.GetSetting("Layer","MinZoom");var MaxZoom=this.GetSetting("Layer","MaxZoom");if(CMUtilities.IsDefined(MinZoom)){Result=this.InZoomRange([MinZoom,MaxZoom]);}}return(Result);};CMLayer.prototype.InZoomRange=function(ZoomRange){var Result=true;var TheScene=this.GetScene();if((ZoomRange!=null)&&(TheScene!=null)&&(TheScene.GetView(0)!=null)){var TheView=TheScene.GetView(0);var TheZoom=TheView.GetZoomLevel();if((TheZoom<ZoomRange[0])||(TheZoom>ZoomRange[1])){Result=false;}}return(Result);}
CMLayer.prototype.IsFeatureVisible=function(FeatureIndex){var Result=this.IsVisible();if(Result){var MinZoom=this.GetFeatureSetting("Layer","MinZoom",FeatureIndex);var MaxZoom=this.GetFeatureSetting("Layer","MaxZoom",FeatureIndex);if(MinZoom!=null){Result=this.InZoomRange([MinZoom,MaxZoom]);}}return(Result);};CMLayer.prototype.SetBounds=function(NewBounds){this.TheBounds=NewBounds;}
CMLayer.prototype.GetBounds=function(){return(this.TheBounds);}
CMLayer.prototype.GetScene=function(){var Result=this.GetParent(CMScene);return(Result);}
CMLayer.prototype.GetCanvasMap=function(){var Result=this.GetParent(CMMainContainer);return(Result);}
CMLayer.prototype.SetInfoWindowWidth=function(NewWidth){this.InfoWindowWidth=NewWidth;}
CMLayer.prototype.GetInfoWindowWidth=function(){return(this.InfoWindowWidth);}
CMLayer.prototype.SetClickTolerance=function(NewClickTolerance){this.ClickTolerance=NewClickTolerance;}
CMLayer.prototype.SetSelectedFeature=function(New){}
CMLayer.prototype.SetMouseOverFeature=function(New){}
CMLayer.prototype.ResetMouseOverFeature=function(){}
CMLayer.prototype.SetSettingAttribute=function(Group,Key,AttributeName){if(this.SettingsAttributes==null)this.SettingsAttributes={};if((Group in this.SettingsAttributes)==false)this.SettingsAttributes[Group]={}
this.SettingsAttributes[Group][Key]=AttributeName;this.SettingsDirty=true;}
CMLayer.prototype.GetSettingsAttribute=function(Group,Key){var Result=null;if(this.SettingsAttributes!==null){if(Group in this.SettingsAttributes){Result=this.SettingsAttributes[Group][Key];}}return(Result);}
CMLayer.prototype.SetFeatureSettings=function(FeatureIndex,OneFeaturesSettings){if(this.FeatureSettings==null){this.FeatureSettings=new Array();}this.FeatureSettings[FeatureIndex]=OneFeaturesSettings;}
CMLayer.prototype.GetFeatureSettings=function(FeatureIndex,TheDefault){this.SettingsChanged();var Result=TheDefault;if(this.FeatureSettings!=null){Result=this.FeatureSettings[FeatureIndex];}return(Result);}
CMLayer.prototype.SetFeatureSettingGroup=function(Group,FeatureIndex,OneFeaturesSettingGroup){if(this.FeatureSettings==null){this.FeatureSettings=new Array();}if(this.FeatureSettings[FeatureIndex]==undefined)this.FeatureSettings[FeatureIndex]={};if(this.FeatureSettings[FeatureIndex][Group]==undefined)this.FeatureSettings[FeatureIndex][Group]={};this.FeatureSettings[FeatureIndex][Group]=OneFeaturesSettingGroup;}
CMLayer.prototype.GetFeatureSettingGroup=function(Group,FeatureIndex,Default){this.SettingsChanged();var Result=Default;if(this.FeatureSettings!=null){if(this.FeatureSettings[FeatureIndex]!=undefined){if(this.FeatureSettings[FeatureIndex][Group]!=undefined)Result=this.FeatureSettings[FeatureIndex][Group];}}return(Result);}
CMLayer.prototype.SetFeatureSetting=function(Group,Key,FeatureIndex,Value){if(this.FeatureSettings==null)this.FeatureSettings=new Array();if(this.FeatureSettings[FeatureIndex]==undefined)this.FeatureSettings[FeatureIndex]={};if((Group in this.FeatureSettings[FeatureIndex])==false)this.FeatureSettings[FeatureIndex][Group]={};this.FeatureSettings[FeatureIndex][Group][Key]=Value;}
CMLayer.prototype.GetFeatureSetting=function(Group,Key,FeatureIndex,Default){this.SettingsChanged();var Result=this.GetSetting(Group,Key,Default);if(this.FeatureSettings!==null){var TheFeaturesSettings=this.FeatureSettings[FeatureIndex];if(TheFeaturesSettings!=undefined){if(Group in TheFeaturesSettings){var Result=this.FeatureSettings[FeatureIndex][Group][Key];}}}return(Result);}
CMLayer.prototype.SetIconImage=function(TheURL,OffsetX,OffsetY){var TheImage=new Image();TheImage.Loaded=false;TheImage.TheURL=TheURL;TheImage.TheLayer=this;TheImage.OffsetX=OffsetX;TheImage.OffsetY=OffsetY;TheImage.onload=function(){this.Loaded=true;this.TheLayer.SetSetting("IconImage","URL",this.TheURL);this.TheLayer.SetSetting("IconImage","TheImage",this);this.TheLayer.SetSetting("IconImage","OffsetX",this.OffsetX);this.TheLayer.SetSetting("IconImage","OffsetY",this.OffsetY);this.TheLayer.Repaint();};TheImage.src=TheURL;};CMLayer.prototype.SetFeatureIconImage=function(FeatureIndex,TheURL,OffsetX,OffsetY){var TheImage=new Image();TheImage.FeatureIndex=FeatureIndex;TheImage.Loaded=false;TheImage.TheLayer=this;TheImage.OffsetX=OffsetX;TheImage.OffsetY=OffsetY;TheImage.onload=function(){this.Loaded=true;this.TheLayer.SetFeatureSetting("IconImage","URL",this.FeatureIndex,this.TheURL);this.TheLayer.SetFeatureSetting("IconImage","TheImage",this.FeatureIndex,this);this.TheLayer.SetFeatureSetting("IconImage","OffsetX",this.FeatureIndex,this.OffsetX);this.TheLayer.SetFeatureSetting("IconImage","OffsetY",this.FeatureIndex,this.OffsetY);this.TheLayer.Repaint();};TheImage.src=TheURL;};CMLayer.prototype.SetupLabelFont=function(TheView,FeatureIndex){var LabelFont=this.GetFeatureSetting("Text","font",FeatureIndex,"Arial 12px");var FontFace="Arial";var FontSize=20;if((LabelFont!=null)&&(LabelFont!=undefined)){var Index=LabelFont.indexOf("px");if(Index!=-1){var Temp=LabelFont.substring(0,Index);var Index2=Temp.lastIndexOf(" ");if(Index2!=-1)Temp=Temp.substring(Index2+1);FontSize=parseInt(Temp);}}var TheContext=TheView.GetContext();TheContext.font=LabelFont;return(FontSize);}
CMLayer.prototype.PaintPoint=function(TheView,FeatureIndex,RefX,RefY,SelectedOnly){if(this.IsFeatureVisible(FeatureIndex)){this.SettingsChanged();var Result=TheView.GetPixelFromRef(RefX,RefY);var PixelX=Result.PixelX;var PixelY=Result.PixelY;var TheFeatureImage=this.GetSettingGroup("IconImage");var TheFeatureImage=this.GetFeatureSettingGroup("IconImage",FeatureIndex,TheFeatureImage);if(TheFeatureImage.TheImage!==undefined){var Bounds={XMin:PixelX+TheFeatureImage.OffsetX,XMax:PixelX+TheFeatureImage.OffsetX+TheFeatureImage.TheImage.width,YMin:PixelY+TheFeatureImage.OffsetY,YMax:PixelY+TheFeatureImage.OffsetY+TheFeatureImage.TheImage.height};if(TheView.CheckCollision(Bounds)==false){TheView.AddToCollisions(Bounds);TheView.PaintImage(TheFeatureImage.TheImage,PixelX+TheFeatureImage.OffsetX,PixelY+TheFeatureImage.OffsetY);}}else{var TheStyle=this.GetStyle(TheView);var TheFeatureStyle=this.GetFeatureSettingGroup("Style",i,TheStyle);if(TheFeatureStyle!==null){TheView.SetStyle(TheFeatureStyle,false);}var TheSize=this.GetFeatureSetting("Mark","Size",FeatureIndex,5);var TheType=this.GetFeatureSetting("Mark","Type",FeatureIndex,CMLayer.MARK_CIRCLE);var HalfSize=TheSize/2;var Bounds={XMin:PixelX-HalfSize,XMax:PixelX+HalfSize,YMin:PixelY-HalfSize,YMax:PixelY+HalfSize};if(TheView.CheckCollision(Bounds)==false){TheView.AddToCollisions(Bounds);switch(TheType){case CMLayer.MARK_CIRCLE:TheView.PaintCircle(PixelX,PixelY,HalfSize);break;case CMLayer.MARK_SQUARE:TheView.PaintRect(PixelX-HalfSize,PixelX+HalfSize,PixelY-HalfSize,PixelY+HalfSize);break;case CMLayer.MARK_TRIANGLE:{var TheRefSize=TheView.GetRefWidthFromPixelWidth(TheSize);var Triangle=CMUtilities.GetRegularPolygon(3,TheRefSize/2,RefX,RefY,180);TheView.PaintRefPoly2(Triangle[0],Triangle[1],true,true);}break;case CMLayer.MARK_STAR:{var TheRefSize=TheView.GetRefWidthFromPixelWidth(TheSize);var Star=CMUtilities.GetStar(5,TheRefSize,RefX,RefY,0);TheView.PaintRefPoly2(Star[0],Star[1],true,true);}break;}}}var TheLabel=this.GetFeatureSetting("Text","Text",FeatureIndex,null);if(TheLabel!=null){var LabelStyle=this.GetStyle(TheView,0,"Text");if(LabelStyle!=undefined)TheView.SetStyle(LabelStyle);var FontSize=this.SetupLabelFont(TheView,FeatureIndex);var TheContext=TheView.GetContext();var OffsetX=10;var OffsetY=10;var Direction=null;var LabelPosition=this.GetFeatureSetting("LabelBox","Position",FeatureIndex,null);if(LabelPosition!=null){OffsetX=LabelPosition.OffsetX;OffsetY=LabelPosition.OffsetY;Direction=LabelPosition.Direction;}var Lines=TheLabel.split("<br>");var Height=Lines.length*FontSize;var LineWidths=[];var MaxWidth=0;for(var i=0;i<Lines.length;i++){Lines[i]=Lines[i].trim();LineWidths.push(TheContext.measureText(Lines[i]).width);if(LineWidths[i]>MaxWidth)MaxWidth=LineWidths[i];}var PixelLeft=0;switch(Direction){case"TL":case"L":case"BL":PixelLeft=PixelX-OffsetX-MaxWidth;break;case"T":case"B":default:PixelLeft=PixelX-MaxWidth/2;break;case"BR":case"TR":case"R":PixelLeft=PixelX+OffsetY;break;}var PixelTop=0;switch(Direction){case"TL":case"T":case"TR":PixelTop=PixelY-OffsetY-Height;break;case"R":case"L":default:PixelTop=PixelY-Height/2;break;case"BR":case"B":case"BL":PixelTop=PixelY+OffsetY;break;}var X=PixelLeft;var Y=PixelTop+FontSize;var Bounds={XMin:X,XMax:X+MaxWidth,YMin:Y-Height,YMax:Y};if(TheView.CheckCollision(Bounds)==false){TheView.AddToCollisions(Bounds);TheContext.textBaseline="bottom";for(var i=0;i<Lines.length;i++){switch(Direction){case"TL":case"L":case"BL":X=PixelLeft+MaxWidth-LineWidths[i];break;case"T":case"B":default:X=PixelLeft+((MaxWidth-LineWidths[i])/2);break;case"BR":case"TR":case"R":X=PixelLeft;break;}TheContext.fillText(Lines[i],X,Y);TheContext.strokeText(Lines[i],X,Y);Y+=FontSize;}}if(LabelStyle!=undefined)TheView.RestoreStyle();}}};CMLayer.prototype.PaintPoly=function(TheView,FeatureIndex,TheCoordinates,Closed,SelectedOnly){if(this.IsFeatureVisible(FeatureIndex)){if(SelectedOnly){var TheSelectedStyle=this.GetStyle(TheView,0,"SelectedStyle");if(TheSelectedStyle!==null){TheView.SetStyle(TheSelectedStyle,true);}TheView.PaintRefPoly(TheCoordinates,Closed)
if(TheSelectedStyle!==null){TheView.RestoreStyle(TheSelectedStyle);}}else{var TheFeatureStyle=this.GetFeatureSettingGroup("Style",FeatureIndex,null);if(TheFeatureStyle!==null){TheView.SetStyle(TheFeatureStyle,true);}TheView.PaintRefPoly(TheCoordinates,Closed)
if(TheFeatureStyle!==null){TheView.RestoreStyle(TheFeatureStyle);}}}}
CMLayer.prototype.OnLoad=function(){this.SettingsChanged();if(this.GetScene()==null){alert("Sorry, you'll need to add the layer to the CanvasMap before you can all 'SetURL()'.");}else{this.GetScene().SetBoundsDirty();}}
CMLayer.prototype.ViewMoved=function(TheView){}
CMLayer.prototype.In=function(TheView,RefX,RefY){var FeatureIndex=-1;return(FeatureIndex);};CMLayer.prototype.MouseDown=function(TheView,RefX,RefY){var Used=false;if((this.IsVisible())&&(this.GetClickable())&&((TheView.GetTool()==CMView.TOOL_INFO)||(TheView.GetTool()==CMView.TOOL_SELECT))){var FeatureIndex=this.In(TheView,RefX,RefY);if(FeatureIndex!=-1){this.SetSelectedFeature(FeatureIndex);this.ShowInfoWindow(FeatureIndex,TheView,RefX,RefY);Used=true;}}return(Used);};CMLayer.prototype.MouseMove=function(TheView,RefX,RefY){var Used=false;if(this.Clickable){var FeatureIndex=this.In(TheView,RefX,RefY);if(FeatureIndex!==-1)this.MouseOver(TheView,RefX,RefY,FeatureIndex);else this.ResetMouseOverFeature();}return(Used);};CMLayer.prototype.MouseUp=function(TheView,RefX,RefY){var Used=false;return(Used);};CMLayer.prototype.MouseOver=function(TheView,RefX,RefY,FeatureIndex){var Used=false;this.SetMouseOverFeature(FeatureIndex);return(Used);};CMLayer.prototype.Resize=function(TheView){}
CMLayer.prototype.GetSearchResults=function(SearchPhrase,ResultsPanel){}
CMLayer.prototype.ShowInfoWindow=function(FeatureIndex,TheView,RefX,RefY){var TheHTML=this.GetFeatureSetting("Layer","InfoText",FeatureIndex,null);if(TheHTML!=null){var InfoWindow=TheView.CreateInfoWindow("CMLayer.InfoWindow",RefX,RefY,this.GetInfoWindowWidth(),30,TheHTML);CMMainContainer.SetPopupWindow(InfoWindow);}};CMLayer.prototype.GetIcon=function(){var TheIcon=this.GetSetting("IconImage","TheImage");if(TheIcon==null){var TheType=this.GetSetting("Mark","Type",undefined);var FillStyle=this.GetSetting("Style","fillStyle");var StrokeStyle=this.GetSetting("Style","strokeStyle");if(CMUtilities.IsDefined(TheType)==false){TheIcon=document.createElement('div');TheIcon.className="CM_LayerListIconClass";TheIcon.TheLayer=this;if(CMUtilities.IsDefined(FillStyle))TheIcon.style.backgroundColor=FillStyle;else TheIcon.style.backgroundColor=undefined;if(CMUtilities.IsDefined(StrokeStyle))TheIcon.style.borderColor=StrokeStyle;else TheIcon.style.borderColor=undefined;}else{TheIcon=document.createElement('div');TheIcon.className="CM_LayerListIconClass";TheIcon.TheLayer=this;TheIcon.style.backgroundColor="rgba(0,0,0,0)";TheIcon.style.borderColor="rgba(0,0,0,0)";var TheCanvas=document.createElement('CANVAS');TheCanvas.width=16;TheCanvas.height=16;TheIcon.appendChild(TheCanvas);var PixelX=0;var PixelY=0;var HalfSize=7;var HalfSize=7;var TheSize=14;var TheView=new CMView2D();TheView.Setup(TheIcon,TheCanvas);TheView.SetStyle({fillStyle:FillStyle,strokeStyle:StrokeStyle});switch(TheType){case CMLayer.MARK_CIRCLE:TheView.PaintCircle(PixelX+HalfSize+1,PixelY+HalfSize+1,HalfSize);break;case CMLayer.MARK_SQUARE:TheView.PaintRect(PixelX+1,PixelX+TheSize,PixelY+1,PixelY+TheSize);break;case CMLayer.MARK_TRIANGLE:{var Triangle=CMUtilities.GetRegularPolygon(3,HalfSize+2,HalfSize+1,-HalfSize-2,180);TheView.PaintRefPoly2(Triangle[0],Triangle[1],true,true);}break;case CMLayer.MARK_STAR:{var Star=CMUtilities.GetStar(5,TheSize,HalfSize+1,-HalfSize-1,36);TheView.PaintRefPoly2(Star[0],Star[1],true,true);}break;}}}return(TheIcon);}
CMLayer.prototype.FillPopupMenu=function(ThePopupMenu){var DeleteElement=document.createElement('div');DeleteElement.setAttribute("id","CM_DeleteElementMenuItem");DeleteElement.className="CM_LayerListPopupMenuItem";DeleteElement.innerHTML="Delete";DeleteElement.TheLayer=this;DeleteElement.ThePopupMenu=ThePopupMenu;DeleteElement.addEventListener('click',function(event){var TheScene=this.TheLayer.GetParent(CMScene);this.ThePopupMenu.style.visibility="hidden";var LayerIndex=TheScene.GetLayerIndex(this.TheLayer);TheScene.DeleteLayer(LayerIndex);event.stopPropagation();});ThePopupMenu.appendChild(DeleteElement);if(this.GetBounds()!=null){var ZoomToElement=document.createElement('div');ZoomToElement.className="CM_LayerListPopupMenuItem";ZoomToElement.setAttribute("id","CM_ZoomToExtentMenuItem");ZoomToElement.innerHTML="Zoom To This Layer";ZoomToElement.TheLayer=this;ZoomToElement.ThePopupMenu=ThePopupMenu;ZoomToElement.addEventListener('click',function(event){this.ThePopupMenu.style.visibility="hidden";var TheBounds=this.TheLayer.GetBounds();var TheScene=this.TheLayer.GetParent(CMScene);var TheView=TheScene.GetView(0);TheView.ZoomToBounds(TheBounds);event.stopPropagation();});ThePopupMenu.appendChild(ZoomToElement);}}